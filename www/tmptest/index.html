<!DOCTYPE html>
<html>
<head>
<!-- Substitute {partner_id} for your Kaltura partner id, {uiconf_id} for uiconf player id -->
<!-- <script src="https://d38ynedpfya4s8.cloudfront.net/p/296/sp/29600/embedIframeJs/uiconf_id/23449664/partner_id/296"></script>   --->
<!--- src="https://d38ynedpfya4s8.cloudfront.net/p/296/sp/29600/embedIframeJs/uiconf_id/23449664/partner_id/296 --->
	<script type = "text/javascript" src="getvideoV2.js"></script> 
	<link rel="stylesheet" href="styles.css">
</head>

<body>
<h1>Sida som visar saker</h1>
<p>Hej, här är en video V2.</p>
<div id="myData"></div>
<div id="embededPlayer" style="width:600px;height:428px;"></div>

<div id="contentinfo">
	<div id="contentinfo.rubrik"></div>
	<div id="contentinfo.datum"></div>
</div>
<div id="medialink">link</div>


	<!-- Substitute {partnerId} for your Kaltura partner id, {uiConfId} for an actual player id, also known as the uiconf id and {entryId} for an actual entry id. -->
	<script src=https://d38ynedpfya4s8.cloudfront.net/p/296/sp/29600/embedIframeJs/uiconf_id/23449664/partner_id/296"></script>
	<script>
	kWidget.embed({
		'targetId': 'embededPlayer',
		'wid': '_296',
		'uiconf_id' : '23449664',
		'entry_id' : '0_x8vi0g1u',
		'flashvars':{ // flashvars allows you to set runtime uiVar configuration overrides. 
			'autoPlay': true,
			'autoPMute': false,
			'allowfullscreen': false,
			 'mobileAutoPlay': true
		},
		'params':{ // params allows you to set flash embed params such as wmode, allowFullScreen etc
			'wmode': 'transparent',
			'allowfullscreen': 'false'
		}
	});

// --- Add callbacks ----
var repeatDelay = 5000;
var seekDone = false;
var seekValue = 0;
var FullScreenWorkaround = true;
var first = true;

	 kWidget.addReadyCallback(function( playerId ){
        var kdp = document.getElementById( playerId );
		
		kdp.kBind("mediaReady.first", function(){ // Hackigt sätt att byta video från början, delay för att undvika krock i play-anrop.
			//kdp.sendNotification('cleanMedia');
			//kdp.sendNotification('changeMedia',{'entryId' : '0_90p47kwj' });
			kdp.sendNotification('showClosedCaptions');

			setTimeout(function(){
				PlayNewRandomVideo();
				first = false;
				//alert("test");
				console.log("First time setup is done.");
			},500);
			kdp.kUnbind('.first');
		});

        kdp.kBind("mediaReady", function( ){
//            kdp.sendNotification("changeVolume", 0.1);
			if (FullScreenWorkaround) {
				FullScreenWorkaround = false;
				kdp.sendNotification('closeFullScreen');
			}

			if( ! seekDone ){
			kdp.sendNotification('doSeek', seekValue);
			}
			seekDone = true;
        });
		
//   kdp.kBind('playerSeekEnd', function(){
//		kdp.sendNotification("changeVolume", 0.1);
//	});
	
//	kdp.kBind('playerUpdatePlayhead', function(){
//	});

/*
	kdp.kBind('mediaReady', function(){ 
		//kdp.sendNotification('doPlay');		

		if (first)// FIX: Pga fulhacket ovan triggas denna annars 2 ggr med 500ms mellanrum 1a gången.
			return;
			
		setTimeout(function(){
			PlayNewRandomVideo();			
		},repeatDelay)
	})
*/

	function PlayNewRandomVideo()
	{
		kdp.sendNotification('doStop');
		kdp.sendNotification('cleanMedia');
		seekDone = false;
		var NewMedia = GetRandomVideo();

		if (NewMedia.rubrik != undefined)
		{
			seekValue = NewMedia.start;
			kdp.sendNotification('changeMedia',{'entryId' : NewMedia.videoid } );
			SetContentInfo(NewMedia);
			SetLink(NewMedia);

//		alert(GetRandomVideo());
			setTimeout(function(){
				PlayNewRandomVideo();			
			},repeatDelay)
		} else
		{
			console.log("JSON-data ej laddat ännu, väntar lite till.");
			setTimeout(function(){
				PlayNewRandomVideo();			
			},700)
		}

	}

 });

 	function SetContentInfo(data)
	 {
		 var rubrik = document.getElementById("contentinfo.rubrik")
		 var datum = document.getElementById("contentinfo.datum")

		 rubrik.innerHTML='Rubrik:'+data.rubrik;
		 datum.innerHTML='Datum:'+data.datum;
		 
	 }

 	function SetLink(data)
	 {
		var ml = document.getElementById("medialink");
        ml.innerHTML = '<a href="https://play.umu.se/media/t/'+data.videoid+'" target="_blank"> Open this talk </a>';
	 }

	</script>
  
</body>
</html>
